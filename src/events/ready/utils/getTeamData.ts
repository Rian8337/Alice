import { DatabaseManager } from "@alice-database/DatabaseManager";
import { UserBind } from "@alice-database/utils/elainaDb/UserBind";
import { EventUtil } from "@alice-interfaces/core/EventUtil";
import { Snowflake } from "discord.js";
import { Player } from "osu-droid";

export const run: EventUtil["run"] = async () => {
    const IDs: Snowflake[] = [
        "452041256319582208",
        "769925273843662928",
        "414064379579990016",
        "566158438636453898",
        "454165374263492608",
        "608246164034420746",
        "744826856749924425",
        "756073430851387433",
        "578325328150134799",
        "464836444398026754",
        "516100971697537054",
        "557618093925597184",
        "844725001331671041",
        "673458400864239659",
        "510813905547821067",
        "751840451727982708",
        "590885527851630597",
        "470277450551656459",
        "782405871502098434",
        "561177214171873311",
        "312501015280746497",
        "275233595562524674",
        "295681738535862282",
        "541027271704838164",
        "294163291394015234",
        "428707020665913364",
        "670517017060835339",
        "540097237511045120",
        "283212911680159744",
        "607654271239979094",
        "216182710715154432",
        "361149027703848960",
        "816588720777199676",
        "588483268219764868",
        "884367652934524938",
        "412584103481704448",
        "353383759107588098",
        "596007184995713041",
        "248188848746659842",
        "795226998766174218",
        "333438692284694530",
        "406790671438184458",
        "675733205743304719",
        "491118590938841090",
        "468198750377082880",
        "910657655691960330",
        "530933021570760710",
        "332229046605709322",
        "384741262932049924",
        "345918631248396289",
        "780882239679365151",
        "360457586098700288",
        "349357823521718284",
        "730986447229943838",
        "254714743565058058",
        "328857181543858188",
        "326834396969566210",
        "590559153311842323",
        "706420335846621194",
        "346178468490248193",
        "857236913890394112",
        "845015742088347659",
        "289680792739905536",
        "639472615207206933",
        "509455013844746251",
        "332816072845557760",
        "904714911467323424",
        "696585248774946876",
        "798040037270880297",
        "494471414431219712",
        "742714730933780621",
        "791554685164453894",
        "578469110632022016",
        "566981266486984704",
        "689793654214361088",
        "842015648061980753",
        "493742292226539521",
        "310700824529469442",
        "903280227483005000",
        "447339599858106368",
        "719495651091808278",
        "619545586798166046",
        "752578546081333358",
        "360720818214404096",
        "689981196553289873",
        "651849905517756453",
        "399920460311166977",
        "376636856626053120",
        "635271404199084052",
        "783425234232672296",
        "721943772845441034",
        "665605844494188584",
        "692633743738798080",
        "533450946886238224",
        "715078047887261767",
        "443580845513637888",
        "351571074577596416",
        "423237900621316098",
        "705260973669482507",
        "769807282426347521",
        "229718585038209024",
        "282999559385513984",
    ];

    const playerNames: string[] = [];
    const playerRanks: number[] = [];
    const playerUids: number[] = [];

    for (const ID of IDs) {
        const bindInfo: UserBind | null =
            await DatabaseManager.elainaDb.collections.userBind.getOne(
                { discordid: ID },
                { projection: { _id: 0, discordid: 1, previous_bind: 1 } }
            );

        if (!bindInfo) {
            playerNames.push("N/A");
            playerRanks.push(Number.NaN);
            playerUids.push(Number.NaN);
            continue;
        }

        let player: Player = new Player();

        for (const uid of bindInfo.previous_bind) {
            const currentPlayer = await Player.getInformation({ uid: uid });

            if (!currentPlayer.username) {
                continue;
            }

            if (
                (player.rank || Number.POSITIVE_INFINITY) > currentPlayer.rank
            ) {
                player = currentPlayer;
            }
        }

        playerNames.push(`"${player.username}"`);
        playerRanks.push(player.rank);
        playerUids.push(player.uid);
    }

    console.log(`Player names: ={${playerNames.join(";")}}`);
    console.log(`Player uids: ={${playerUids.join(";")}}`);
    console.log(`Player ranks: ={${playerRanks.join(";")}}`);
};

export const config: EventUtil["config"] = {
    description: "idk lol",
    togglePermissions: ["BOT_OWNER"],
    toggleScope: ["GLOBAL"],
    debugEnabled: true,
};
